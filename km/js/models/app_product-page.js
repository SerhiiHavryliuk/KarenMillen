"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var o=i[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(i,t,o){return t&&e(i.prototype,t),o&&e(i,o),i}}(),FrondevoProductPageUI=function(){function e(){_classCallCheck(this,e),this.bigPhotoGallery=$("#item-page-big-photo-gallery"),this.bigPhotoGalleryItem=$("#item-page-big-photo-gallery li"),this.previewGalleryWrap=$(".item-page__photo-preview-layout"),this.selPreviewsGallery="#itempage__photo-preview-list",this.previewsGallery=$(this.selPreviewsGallery),this.photoPreviewSwitchWrap=$("#item-page__photo-preview-switch"),this.photoPreviewSwitchItems=this.photoPreviewSwitchWrap.find("li"),this.photoPreviewSwithingTypeRow=$("#item-page__photo-type-switching-row"),this.classNamePhotoPreviewTypeRow="item-page__photo-row_two-preview",this.previewItemFor2rooType=this.previewsGallery.find("a"),this.gotoDescription=$("#go-to-desc"),this.description=$("#item-page-description"),this.sharingToggleButton=$("#item-page-sharing-toggle"),this.sharingPanel=$("#sharing-panel"),this.infoTabsListItem=this.description.find("li"),this.infoTabsContentItem=$(".item-page__tabs-content"),this.buttonShowPopupSizeGuide=$("#show-size-guide"),this.selectorPopupSizeGuide="#popup-size-guide",this.sizeGuideTabs=$("#tabs-size-guide"),this.sizeGuideActiveTab=this.buttonShowPopupSizeGuide.attr("data-active-tabs"),this.productIdForCurrentPage=parseInt($("[data-product-id]").attr("data-product-id")),this.urlGetHTMLRecentlyViewed="php/get-recently-viewed.json",this.localStorageNameForArrProductId="RecentlyViewedProducts",this.arrIdRecentlyViewedProducts=JSON.parse(localStorage.getItem(this.localStorageNameForArrProductId))||[],this.sessionStorageNameForDidWeSend="didWeSendRecentlyViewedAlready",this.elWrapForRecentlyViewed=$("#recently-viewed"),this._eventHandlersInit()}return _createClass(e,[{key:"_switchTypePreviewPhotos",value:function(e){$(e).hasClass("active")||(this.photoPreviewSwitchItems.removeClass("active"),$(e).addClass("active")),$(e).hasClass("item-page__photo-preview_2col")?(this.photoPreviewSwithingTypeRow.addClass(this.classNamePhotoPreviewTypeRow),this._reloadRelatedGalleries("two-preview-columns")):(this.photoPreviewSwithingTypeRow.removeClass(this.classNamePhotoPreviewTypeRow),this._reloadRelatedGalleries("one-preview-columns"))}},{key:"_reloadRelatedGalleries",value:function(e){$(this.selPreviewsGallery+" a").show(),this.previewsGalleySlider.destroySlider();var i=$(this.selPreviewsGallery).clone(!0);this.bigGallerySlider.destroySlider(),$(this.selPreviewsGallery).remove(),this.previewGalleryWrap.prepend(i),this.bigGallerySlider.bxSlider({pagerCustom:this.selPreviewsGallery,onSlideAfter:function(e){e.hasClass("item-page__video-item")&&e.find("video").eq(0).get(0).play()},onSlideBefore:function(e){e.hasClass("item-page__video-item")&&e.find("video").eq(0).get(0).pause()}}),"one-preview-columns"==e&&(this.previewsGalleySlider=$(this.selPreviewsGallery).bxSlider({pager:!1,mode:"vertical",minSlides:3,slideMargin:10}))}},{key:"_showHiddenPreviews",value:function(e){var i=this.previewItemFor2rooType.length;if(!this.photoPreviewSwithingTypeRow.hasClass(this.classNamePhotoPreviewTypeRow)||i<=4)return!0;var t=$(this.selPreviewsGallery+" a:visible").length;t>4?$(e).hide():$(e).prevAll("a:hidden").show()}},{key:"_gotoDescription",value:function(){var e=this.description.offset(),i=parseInt(e.top)-50;$("html, body").animate({scrollTop:i},1e3)}},{key:"_sharingPanelToggle",value:function(){this.sharingPanel.hasClass("active")?this.sharingPanel.removeClass("active"):this.sharingPanel.addClass("active")}},{key:"_initModules",value:function(){this.bigGallerySlider=this.bigPhotoGallery.bxSlider({pagerCustom:this.selPreviewsGallery,onSlideAfter:function(e){e.hasClass("item-page__video-item")&&e.find("video").eq(0).get(0).play()},onSlideBefore:function(e){e.hasClass("item-page__video-item")&&e.find("video").eq(0).get(0).pause()}}),this.previewsGalleySlider=this.previewsGallery.bxSlider({pager:!1,mode:"vertical",minSlides:3,slideMargin:10}),this._refreshModules();new FrondevoTabsUI(this.infoTabsListItem,this.infoTabsContentItem);this.popupSizeGuide=new FrondevoPopup({popupSelector:this.selectorPopupSizeGuide,overlayStatus:!0,overlaySelector:"#overlay"}),this.sizeGuideTabs.tabs({active:this.sizeGuideActiveTab})}},{key:"_refreshModules",value:function(){this.bigPhotoGalleryItem.trigger("zoom.destroy"),window.innerWidth>1e3&&this.bigPhotoGalleryItem.zoom({on:"click",dataUrl:"data-zoom-src",onZoomIn:function(){$(".item-page__photo-big").find(".bx-controls-direction").hide()},onZoomOut:function(){$(".item-page__photo-big").find(".bx-controls-direction").show()}})}},{key:"_showSizeGuide",value:function(){this.popupSizeGuide.showPopup()}},{key:"_checkIfSendRecentlyViewedAlready",value:function(){var e=this,i=sessionStorage.getItem(this.sessionStorageNameForDidWeSend);if("true"!=i)if(sessionStorage.setItem(this.sessionStorageNameForDidWeSend,"true"),this.arrIdRecentlyViewedProducts.length>0){var t="data-products-id="+this.arrIdRecentlyViewedProducts;this._ajaxSendToServerRecentlyViewedProductId(t).then(function(i){"OK"==i.status.toUpperCase()&&e._appendRecentlyViewedHTMLFromAJAX(i.htmlCode),e._saveForRecentlyViewedProductId()},function(e){console.error("Не удалось загрузить данные!",e)})}else this._saveForRecentlyViewedProductId()}},{key:"_saveForRecentlyViewedProductId",value:function(){var e=this.arrIdRecentlyViewedProducts.indexOf(this.productIdForCurrentPage);e!=-1&&this.arrIdRecentlyViewedProducts.splice(e,1),this.arrIdRecentlyViewedProducts.splice(0,0,this.productIdForCurrentPage),this.arrIdRecentlyViewedProducts.splice(5,1),localStorage.setItem(this.localStorageNameForArrProductId,JSON.stringify(this.arrIdRecentlyViewedProducts))}},{key:"_ajaxSendToServerRecentlyViewedProductId",value:function(e){var i=$.Deferred();return $.ajax({type:"get",dataType:"json",url:this.urlGetHTMLRecentlyViewed,data:e}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e.statusText)}),i.promise()}},{key:"_appendRecentlyViewedHTMLFromAJAX",value:function(e){this.elWrapForRecentlyViewed.append(e)}},{key:"_eventHandlersInit",value:function(){var e=this;$(document).on("ready",function(){return e._initModules()}),$(document).on("ready",function(){return e._checkIfSendRecentlyViewedAlready()}),this.photoPreviewSwitchItems.on("click",function(i){return e._switchTypePreviewPhotos(i.currentTarget)}),this.gotoDescription.on("click",function(){return e._gotoDescription()}),this.sharingToggleButton.on("click",function(){return e._sharingPanelToggle()}),this.previewItemFor2rooType.on("click",function(i){return e._showHiddenPreviews(i.currentTarget)}),$(window).on("resize",function(){return e._refreshModules()}),this.buttonShowPopupSizeGuide.on("click",function(){return e._showSizeGuide()})}}]),e}(),productPage=new FrondevoProductPageUI;