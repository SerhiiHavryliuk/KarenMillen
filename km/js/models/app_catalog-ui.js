"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),FrondevoCataloglUI=function(){function e(){_classCallCheck(this,e),this.buttonToggleFilters=$(".catalog__action-panel-show-filters"),this.filtersPanel=$(".catalog__filters-layout"),this.arrFilterButtonText=$("[data-filter-button-toggle-text]"),this.subfiltersButtons=$(".catalog__filters-section-title"),this.filterForm=$("[data-filters-form]"),this.filterSelected=$(".catalog__filters-selected"),this.filterSelectedList=$("[data-filters-selected-list]"),this.filterReset=$("[data-filters-reset]"),this.sliderBox=$("[data-price-slider]").parent(),this.filterMobSend=$("[data-filters-mob-send]"),this.filterTitle=".catalog__filters-section-title",this.filterSliderResetBtn="[data-price-slider-reset]",this.selectSort=$("#catalog__sort-select"),this.switchProductViewType=$("#catalog__type-view"),this.switchProductViewTypeItem=this.switchProductViewType.find("li"),this.productsList=$("#catalog__pruduct-list"),this.globalCatalogLayout=$(".catalog__products-list-layout-row"),this.footer=$(".footer"),this.productItemClass="e-card-2",this.productHiddenItemClass="e-card-2_hide",this.urlGetProducts=this.productsList.attr("data-get-items-url"),this.arrFormsWhatNeedForGetCatalogItems=["#catalog__sort-form, [data-filters-form]"],this.arrAttrWhatNeedForGetCatalogItems=[{selector:"#catalog__pruduct-list",attrName:"data-list-page"},{selector:"#catalog__pruduct-list",attrName:"data-section-type"},{selector:"#catalog__pruduct-list",attrName:"data-section-value"},{selector:"#catalog__pruduct-list",attrName:"data-label-flag"},{selector:"#catalog__pruduct-list",attrName:"data-get-new-page"},{selector:"#catalog__type-view",attrName:"data-catalog-active-type-view"}],this.attrNameGetNewPage="data-get-new-page",this.elWherePrelaoderAppend=$("body"),this.preloaderHTML='<div class="overlay_preloader" id="overlay-preloader"><div class="preloader"></div></div>',this.preloaderSelector="#overlay-preloader",this._initModules(),this._eventHandlersInit()}return _createClass(e,[{key:"_initModules",value:function(){this.footer.visibleOfFooter=new FrondeovoCheckIsVisibleElement(this.footer),this.getCatalogItems=new FrondevoGetCatalogItems(this.urlGetProducts,this.productsList,this.attrForCurentPage),this.visibleOfProductList=new FrondeovoCheckIsVisibleElement(this.productsList),$(".select-selectric").selectric(),this.priceSlider=new FrondevoPriceSlider(this.sliderBox.find("[data-price-slider]"),this.sliderBox.find("[data-price-slider-min-indicator]"),this.sliderBox.find("[data-price-slider-max-indicator]"),this.sliderBox.find("[data-price-slider-min-input]"),this.sliderBox.find("[data-price-slider-max-input]")),this._addPreloader()}},{key:"_showFilters",value:function(e){this.globalCatalogLayout.attr("data-filters-visibiliy","true"),$(e).attr("data-filters","hide"),this._changeFilterButtonText()}},{key:"_hideFilters",value:function(e){this.globalCatalogLayout.attr("data-filters-visibiliy","false"),$(e).attr("data-filters","show"),this._changeFilterButtonText()}},{key:"_toggleSubfilters",value:function(e){$(e).parent().toggleClass("catalog__filters-section_open")}},{key:"filterChange",value:function(e,t){this._changeParameterGetNewPage("false"),this._filterBuildSelected(),this._getCatalogItems("full clean before insert",e,t)}},{key:"_filterBuildSelected",value:function(){this.filterSelectedList.empty(),this._filterBuildSelectedFromCheckBox(),this._filterBuildSelectedFromPriceSlider(),""==$(this.filterSelectedList).html()?this.filterSelected.removeClass("opened"):this.filterSelected.addClass("opened")}},{key:"_filterBuildSelectedFromCheckBox",value:function(){var e=this;this.filterForm.find('input[type="checkbox"]:checked').each(function(){var t=$("[data-filters-selected-checkbox]").eq(0).clone();t.find("[data-filters-selected-name]").text($(this).next().text()),t.find("[data-filters-selected-label]").attr("for",$(this).attr("id")),$(e.filterSelectedList).append(t)})}},{key:"_filterBuildSelectedFromPriceSlider",value:function(){var e=this.filterForm.find("[data-price-slider-min-input]").val(),t=this.filterForm.find("[data-price-slider-max-input]").val(),i=this.filterForm.find("[data-price-slider]").attr("data-min"),a=this.filterForm.find("[data-price-slider]").attr("data-max");if(""==e&&(e=i),""==t&&(t=a),e!=i||t!=a){var r=$("[data-filters-selected-price]").eq(0).clone();r.find("[data-filters-selected-price-slider-min]").text(e),r.find("[data-filters-selected-price-slider-max]").text(t),$(this.filterSelectedList).append(r)}}},{key:"_filterReset",value:function(){this._changeParameterGetNewPage("false"),this.filterForm.find("input").removeAttr("checked"),this.filterSelected.removeClass("opened"),this.priceSlider.reset("not refresh"),this._getCatalogItems("full clean before insert","reset")}},{key:"_changeFilterButtonText",value:function(){this.arrFilterButtonText.each(function(){var e=$(this),t=e.text(),i=e.attr("data-filter-button-toggle-text");e.text(i).attr("data-filter-button-toggle-text",t)})}},{key:"_getDataWhatCanBeSendForGetCatalogItems",value:function(e,t){var i="";return this.arrFormsWhatNeedForGetCatalogItems.forEach(function(e){i+=$(e).serialize()}),this.arrAttrWhatNeedForGetCatalogItems.forEach(function(e){i+="&"+e.attrName+"="+$(e.selector).attr(e.attrName)}),e&&(i+=this._getDataWhatCanBeSendForGetCatalogItemsAddFilterData(e)),t&&(i+="&ignoreFlag=1"),i}},{key:"_getDataWhatCanBeSendForGetCatalogItemsAddFilterData",value:function(e){var t="";if("reset"==e||"mobile"==e)t+="&changeFilter=all";else{var i=$(e).parents(".catalog__filters-section"),a=i.attr("id");t+="&changeFilter="+a}return t}},{key:"_getCatalogItems",value:function(e,t,i){var a=this;this._showPreloader();var r=this._getDataWhatCanBeSendForGetCatalogItems(t,i);this.getCatalogItems.getItems(r).then(function(t){a._showNewCatalogItems(t.htmlCode,e),a._setNewCurrentPage(t.page),t.filters&&a._setNewFilters(t.filters),t.url&&history.pushState("","",t.url),t.kol&&$("[data-catalog-goods-kol]").text(t.kol)},function(e){console.error("Не удалось загрузить данные!",e),this._hidePreloader()})}},{key:"_setNewFilters",value:function(e){for(var t=!1,i=this.sliderBox.parents(".catalog__filters-section").attr("id"),a=0;a<e.length;a++){var r=e[a].name;$("#"+r).html(e[a].content),r==i&&(t=!0)}t&&(this.sliderBox=$("[data-price-slider]").parent(),this.priceSlider=new FrondevoPriceSlider(this.sliderBox.find("[data-price-slider]"),this.sliderBox.find("[data-price-slider-min-indicator]"),this.sliderBox.find("[data-price-slider-max-indicator]"),this.sliderBox.find("[data-price-slider-min-input]"),this.sliderBox.find("[data-price-slider-max-input]"))),this._filterBuildSelected()}},{key:"_addPreloader",value:function(){this.elWherePrelaoderAppend.append(this.preloaderHTML),this.preloader=$(this.preloaderSelector)}},{key:"_showPreloader",value:function(){this.preloader.addClass("show")}},{key:"_hidePreloader",value:function(){this.preloader.removeClass("show")}},{key:"_showNewCatalogItems",value:function(e,t){"full clean before insert"==t&&this.productsList.empty();var i='class="'+this.productItemClass+'"',a='class="'+this.productItemClass+" "+this.productHiddenItemClass+'"';e=e.replace(new RegExp(i,"g"),a),this.productsList.append(e),setTimeout(function(){document.addEventListener("DOMContentLoaded",catalogUI._initSliderForNewItemCards())},400)}},{key:"_initSliderForNewItemCards",value:function(){new FrondevoSmallItemCard("."+this.productItemClass,".ecard-2__slider-layout");$("."+this.productHiddenItemClass).removeClass(this.productHiddenItemClass),this._hidePreloader()}},{key:"_setNewCurrentPage",value:function(e){this.productsList.attr("data-list-page",e)}},{key:"_changeViewTypeOfCatalogItems",value:function(e){if(!$(e).hasClass("active")){var t=$(e).attr("data-catalog-type-view");this.switchProductViewType.attr("data-catalog-active-type-view",t),this._getCatalogItems("full clean before insert"),this.switchProductViewType.find(".active").eq(0).removeClass("active"),$(e).addClass("active")}}},{key:"_changeParameterGetNewPage",value:function(e){this.productsList.attr(this.attrNameGetNewPage,e)}},{key:"_eventHandlersInit",value:function(){var e=this;this.buttonToggleFilters.on("click",function(t){"show"==$(t.currentTarget).attr("data-filters")?e._showFilters(t.currentTarget):e._hideFilters(t.currentTarget)}),$(document).on("click",this.filterTitle,function(t){e._toggleSubfilters(t.currentTarget)}),this.filterForm.on("change",function(t){e.filterChange(t.target)}),this.filterReset.on("click",function(){e._filterReset()}),this.filterMobSend.on("click",function(){e._getCatalogItems("full clean before insert","mobile"),e._hideFilters(e.buttonToggleFilters)}),$(document).on("click",this.filterSliderResetBtn,function(t){e.priceSlider.reset(),$(t.currentTarget).parent().remove()}),this.getCatalogItems.checkIsAnyProductsCanBeLoaded(this.productsList.attr("data-list-page"))&&(window.addEventListener("scroll",function(){return e._changeParameterGetNewPage("true")}),window.addEventListener("scroll",function(){return checkMoreCatalogItems(e.visibleOfProductList,e.productsList)})),this.selectSort.on("change",function(){return e._changeParameterGetNewPage("false")}),this.selectSort.on("change",function(){return e._getCatalogItems("full clean before insert")}),this.switchProductViewTypeItem.on("click",function(){return e._changeParameterGetNewPage("false")}),this.switchProductViewTypeItem.on("click",function(t){return e._changeViewTypeOfCatalogItems(t.currentTarget)})}}]),e}(),catalogUI=new FrondevoCataloglUI,checkMoreCatalogItems=debounce(function(e,t){e.checkIsVisibleBottom()&&"none"!=t.attr("data-list-page")&&catalogUI._getCatalogItems()},250);