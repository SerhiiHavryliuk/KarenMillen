"use strict";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,s){for(var t=0;t<s.length;t++){var o=s[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(s,t,o){return t&&e(s.prototype,t),o&&e(s,o),s}}(),FrondevoGlobalUI=function(){function e(){_classCallCheck(this,e),this.overlay=new FrondevoOverlay,this.globalLayout=$(".layuot-global").eq(0),this.topNav=$("nav.h-menu-dd").eq(0);new FrondevoTopNav(this.topNav);this.buttonShowShopsList=$("#show-shops-list"),this.shopsList=$("#shops-list"),this.shopListWrapForScroll=this.shopsList.find("ul").eq(0),this.footer=$(".footer"),this.formSubscribeSelector="#footer__subscription-form",this.classNameInvalidFormSubscribeRow="invalid-row",this.selectorFormSubscribeRow=".footer__wrap-input",this.selectorErrorSubscribeMessage=".profile__err-mess",this.formSubscribeIdentificator="footer__subscription-form",this.popupSuccessSendFormSubscribeSelector="#popup-subscribe-footer",this.textForSuccessSendFormSubscribe=$(".footer__text-for-success-send-form"),this.buttonClosePopupSuccessMessageformSubscribe=$(".button_popup-mess-close"),this.urlFirstPopupHTMLCode="/api/first-popup",this.elWhereAppendFirstPopup=this.globalLayout,this.firstPopupSelector="#popup-first-visit",this.buttonShowFormForgetPassSelector="#show-form-forget-pass",this.firstPopupForgetPassSelctor="#popup-forget-pass",this.formLoginSelector="#form-login",this.formRecoverySelector="#form-forget-pass",this.classNameInvalidFormRow="invalid-row",this.selectorFormRow=".layout-form-row",this.selectorErrorMessage=".login__err-mess",this.popupFormRecoverMessageClass="login__form_pass-message",this.popupFormRecoverWrapForMessageSelector=".login__success-message",this.delayForShowFirstPopup=parseInt(localStorage.getItem("newVisitorTime"))||2e3,this.mobileFormTabsSelector="#popup-first-visit .title_fourth",this.mobileFormTabActiveClass="login__form_mob-active",this.itemCardSelector=".e-card-2",this.itemCardSliderSelector=".ecard-2__slider-layout",this.horizontalSlider=$(".horisontal-ecards-slider__carousel"),this.searchInput=$("#header-search-input"),this.urlGetSearchSuggestions=this.searchInput.attr("data-autocomplete-url"),this.wrapWhereAppendHTMLCode=this.searchInput.parents("form").eq(0),this.searchSuggestionsSelector="#header-search-suggestions",this.searchResultsInFocus=!1,this.searchInputInFocus=!1,this.header=$(".header"),this.stickFlagAttrName="[data-header-stick]",this.stickTopMenuClass="header_stick",this.topOffsetWhenStickMenu=60,this.reinitSliderAfterWindowResize(),this._eventHandlersInit()}return _createClass(e,[{key:"_stickTopMenu",value:function(){$("body").addClass(this.stickTopMenuClass)}},{key:"_unStickTopMenu",value:function(){$("body").removeClass(this.stickTopMenuClass)}},{key:"_checkIfNeedStickTopMenu",value:function(){if(document.documentElement.clientWidth<1e3)return void this._unStickTopMenu();var e=$(window).scrollTop();e>this.topOffsetWhenStickMenu?this._stickTopMenu():this._unStickTopMenu()}},{key:"reinitSliderAfterWindowResize",value:function(){}},{key:"showOverlay",value:function(){this.overlay.showOverlay()}},{key:"hideOverlay",value:function(){this.overlay.hideOverlay()}},{key:"toggleShopsList",value:function(){var e=this;this.shopsList.hasClass("open")?(this.shopsList.removeClass("header__shops-list_animation"),setTimeout(function(){return e._hideShopsList()},400)):(this.shopsList.addClass("open"),this.shopListWrapForScroll.jScrollPane(),setTimeout(function(){return e._showShopsList()},1))}},{key:"_showShopsList",value:function(){this.shopsList.addClass("header__shops-list_animation")}},{key:"_hideShopsList",value:function(){console.log(1),this.shopsList.removeClass("open")}},{key:"_checkNewVisitor",value:function(){var e=localStorage.getItem("newVisitor")||"true";"true"==e?(localStorage.setItem("newVisitor","false"),localStorage.setItem("newVisitorTime",this.delayForShowFirstPopup),this._checkIsItTimeForShowFirstPopup()):"false"==e&&this.delayForShowFirstPopup>0&&this._checkIsItTimeForShowFirstPopup()}},{key:"_checkIsItTimeForShowFirstPopup",value:function(){var e=this,s=parseInt(localStorage.getItem("newVisitorTime"));if(0==s)this._getHTMLCodeForFirstPopup(),this._decreaseTimeLeftForFirstPopup(s);else{if(!(s>0))return;setTimeout(function(){return e._decreaseTimeLeftForFirstPopup(s)},1e3)}}},{key:"_decreaseTimeLeftForFirstPopup",value:function(e){e-=1e3,localStorage.setItem("newVisitorTime",e),this._checkIsItTimeForShowFirstPopup()}},{key:"_sendData",value:function(){var e=$.Deferred();return $.ajax({type:"get",dataType:"json",url:this.urlFirstPopupHTMLCode}).done(function(s){e.resolve(s)}).fail(function(s){e.reject(s.statusText)}),e.promise()}},{key:"_getHTMLCodeForFirstPopup",value:function(){var e=this;this._sendData().then(function(s){"ERROR"==s.status.toUpperCase()?console.error("Не удалось отправить данные формы!",error):"OK"==s.status.toUpperCase()&&(e.elWhereAppendFirstPopup.append(s.htmlCode),e._showPopupForNewVisitor())},function(e){console.error("Не удалось отправить данные формы!",e)})}},{key:"_showPopupForNewVisitor",value:function(){this.firstPopup=new FrondevoPopup({popupSelector:this.firstPopupSelector,overlayStatus:!0}),this.firstForgetPopup=new FrondevoPopup({popupSelector:this.firstPopupForgetPassSelctor,overlayStatus:!0});new FrondevoAJAXSubmitForm({formSelector:this.formLoginSelector,invalidRowClassName:this.classNameInvalidFormRow,selectorFormRow:this.selectorFormRow,selectorErrorMessage:this.selectorErrorMessage});this.formRec=new FrondevoAJAXSubmitForm({formSelector:this.formRecoverySelector,invalidRowClassName:this.classNameInvalidFormRow,selectorFormRow:this.selectorFormRow,selectorErrorMessage:this.selectorErrorMessage}),this.firstPopup.showPopup()}},{key:"_showForgetPassPopup",value:function(){this.firstPopup.closePopup(),this.firstForgetPopup.showPopup()}},{key:"_showMessageAfrerSuccessSendRecoveryForm",value:function(e){$(this.formRecoverySelector).addClass(this.popupFormRecoverMessageClass),$(this.popupFormRecoverWrapForMessageSelector).text(this.formRec.getServerAsnswer())}},{key:"_formRecoverySetDefaultView",value:function(){$(this.formRecoverySelector).removeClass(this.popupFormRecoverMessageClass)}},{key:"_getSearchSuggestions",value:function(e){var s=this,t=$(e).val();t=t.replace(/\x03/gm,""),$(e).val(t);var o=this.wrapWhereAppendHTMLCode.serialize();t.length>2?this._sendSearchData(o).then(function(e){"OK"==e.status.toUpperCase()&&s._showSearchAutocomple(e.htmlCode)},function(e){console.error("Не удалось отправить данные формы!",e)}):this._refreshAutocompleteResults()}},{key:"_sendSearchData",value:function(e){var s=$.Deferred();return $.ajax({type:"get",dataType:"json",url:this.urlGetSearchSuggestions,data:e}).done(function(e){s.resolve(e)}).fail(function(e){s.reject(e.statusText)}),s.promise()}},{key:"_showSearchAutocomple",value:function(e){this._refreshAutocompleteResults(),this.wrapWhereAppendHTMLCode.append(e)}},{key:"_setFlagOverSearchResults",value:function(){this.searchResultsInFocus=!0}},{key:"_setFlagLeaveSearchResults",value:function(){this.searchResultsInFocus=!1,this._deleteSearchAutocomple()}},{key:"_setFlagFocusSearchInput",value:function(){this.searchInputInFocus=!0}},{key:"_setFlagLeaveSearchInput",value:function(){this.searchInputInFocus=!1,this._deleteSearchAutocomple()}},{key:"_refreshAutocompleteResults",value:function(){$(this.searchSuggestionsSelector).remove()}},{key:"_deleteSearchAutocomple",value:function(){0==this.searchResultsInFocus&&0==this.searchInputInFocus&&($(this.searchSuggestionsSelector).remove(),"mobile"!=varsAPP.viewport.device&&this.searchInput.val(""))}},{key:"_showPopupForSuccessSendFormSubscribe",value:function(e){this.textForSuccessSendFormSubscribe.text(this.formSubscribe.getServerAsnswer()),this.popupSuccessSendFormSubscribe.showPopup()}},{key:"_closePopupSuccessSendFormSubscribe",value:function(){this.popupSuccessSendFormSubscribe.closePopup()}},{key:"_cleanForm",value:function(e){$(this.formSubscribeSelector).find($(this.selectorFormSubscribeRow).removeClass("invalid-row")),document.getElementById(this.formSubscribeIdentificator).reset()}},{key:"_toggleMobFormTabs",value:function(e){var s=$(e).parents("form").eq(0);s.hasClass(this.mobileFormTabActiveClass)?s.removeClass(this.mobileFormTabActiveClass):s.addClass(this.mobileFormTabActiveClass)}},{key:"_initModules",value:function(){var e=this;$(".select-custom").customSelect(),this.header.is(this.stickFlagAttrName)&&(window.addEventListener("scroll",function(){return e._checkIfNeedStickTopMenu()}),window.addEventListener("resize",function(){return e._checkIfNeedStickTopMenu()}));for(var s=(new FrondevoSmallItemCard(this.itemCardSelector,this.itemCardSliderSelector),this.horizontalSlider.length),t=0;t<s;t++){var o=this.horizontalSlider.eq(t).find("li").length;if(document.documentElement.clientWidth>1e3&&o>5){var r=this.horizontalSlider.eq(t).find("li").eq(0).width();this.slider=this.horizontalSlider.eq(t).bxSlider({pager:!1,controls:!0,slideMargin:10,minSlides:2,maxSlides:5,slideWidth:r})}else if(document.documentElement.clientWidth<1e3&&o>2){var i=this.horizontalSlider.eq(t).find("li").eq(0).width();this.slider=this.horizontalSlider.eq(t).bxSlider({pager:!0,controls:!1,slideMargin:0,minSlides:2,maxSlides:2,slideWidth:i})}}this.formSubscribe=new FrondevoAJAXSubmitForm({formSelector:this.formSubscribeSelector,invalidRowClassName:this.classNameInvalidFormSubscribeRow,selectorFormRow:this.selectorFormSubscribeRow,selectorErrorMessage:this.selectorErrorSubscribeMessage}),this.popupSuccessSendFormSubscribe=new FrondevoPopup({popupSelector:this.popupSuccessSendFormSubscribeSelector,overlayStatus:!0});new FrondevoScrollToTop}},{key:"_eventHandlersInit",value:function(){var e=this;$(document).on("ready",function(){return e._initModules()}),this.topNav.on("topMenuDropDown:show",function(){e.showOverlay(),e._hideShopsList()}),this.topNav.on("topMenuDropDown:hide",function(){return e.hideOverlay()}),this.buttonShowShopsList.on("click",function(){return e.toggleShopsList()}),$(window).on("resize",function(){return e.reinitSliderAfterWindowResize()}),$(window).on("load",function(){return e._checkNewVisitor()}),this.elWhereAppendFirstPopup.on("click",this.buttonShowFormForgetPassSelector,function(){return e._showForgetPassPopup()}),this.elWhereAppendFirstPopup.on("ajax-submit:success",this.formRecoverySelector,function(){return e._showMessageAfrerSuccessSendRecoveryForm()}),this.elWhereAppendFirstPopup.on("click",this.mobileFormTabsSelector,function(s){return e._toggleMobFormTabs(s.currentTarget)}),this.searchInput.on("keyup",function(s){return e._getSearchSuggestions(s.currentTarget)}),this.wrapWhereAppendHTMLCode.on("mouseenter",this.searchSuggestionsSelector,function(){return e._setFlagOverSearchResults()}),this.wrapWhereAppendHTMLCode.on("mouseleave",this.searchSuggestionsSelector,function(){return e._setFlagLeaveSearchResults()}),this.searchInput.on("focus",function(){return e._setFlagFocusSearchInput()}),this.searchInput.on("blur",function(){return e._setFlagLeaveSearchInput()}),$(this.formSubscribeSelector).on("ajax-submit:success",function(s){return e._showPopupForSuccessSendFormSubscribe()}),$(this.formSubscribeSelector).on("ajax-submit:success",function(s){return e._cleanForm(s.currentTarget)}),this.buttonClosePopupSuccessMessageformSubscribe.on("click",function(s){return e._closePopupSuccessSendFormSubscribe()})}}]),e}(),globalUI=new FrondevoGlobalUI;